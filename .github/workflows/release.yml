name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: å®‰è£… pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 8

      - name: å®‰è£…ä¾èµ–
        run: pnpm install

      - name: æ„å»ºé¡¹ç›®
        run: pnpm build

      - name: è·å–ç‰ˆæœ¬å·
        id: get_version
        run: |
          TAG=${GITHUB_REF#refs/tags/}
          echo "TAG=$TAG" >> $GITHUB_OUTPUT
          echo "VERSION=$(node -p "require('./package.json').version")" >> $GITHUB_OUTPUT

      - name: åˆ›å»º Release
        uses: softprops/action-gh-release@v2
        with:
          files: dist/6551-plugin-v${{ steps.get_version.outputs.VERSION }}.zip
          body: |
            ## ğŸ“¦ å®‰è£…æ–¹æ³•

            1. ä¸‹è½½ `6551-plugin-v${{ steps.get_version.outputs.VERSION }}.zip`
            2. è§£å‹æ–‡ä»¶
            3. æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè¿›å…¥ `chrome://extensions/`
            4. å¯ç”¨"å¼€å‘è€…æ¨¡å¼"
            5. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
            6. é€‰æ‹©è§£å‹åçš„ç›®å½•
          draft: false
          prerelease: false
